# =============================================================================
# Whisper WebSocket Server - File Descriptor and Process Limits
# =============================================================================
#
# Install with:  sudo cp scripts/limits-whisper.conf /etc/security/limits.d/whisper.conf
# Or run:        sudo ./scripts/tune-kernel.sh
#
# These limits are read by PAM (pam_limits.so) on login. Changes take effect
# in NEW shell sessions only -- existing sessions keep their old limits.
#
# For systemd services, you must ALSO set LimitNOFILE= in the unit file:
#   [Service]
#   LimitNOFILE=1048576
#
# NOTE (Docker): Container processes inherit limits from the Docker daemon
# and the container runtime, not from /etc/security/limits.d/. Use
# --ulimit nofile=1048576:1048576 in docker run, or set ulimits in
# docker-compose.yml under the service definition.
# =============================================================================

# --- File Descriptors (nofile) ---
# Each WebSocket connection = 1 file descriptor.
# 1,048,576 = 1M, matching our target connection count.
# Both soft and hard are set equal so the process gets the full allocation
# without needing to call setrlimit() at startup.
*        soft    nofile    1048576
*        hard    nofile    1048576
root     soft    nofile    1048576
root     hard    nofile    1048576

# --- Max User Processes (nproc) ---
# Go uses goroutines (not OS threads) so nproc is not the bottleneck,
# but a generous limit avoids surprises from helper processes, scripts,
# or health-check forks.
*        soft    nproc     65535
*        hard    nproc     65535
