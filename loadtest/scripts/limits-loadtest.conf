# =============================================================================
# Whisper Load Test Client - File Descriptor and Process Limits
# =============================================================================
#
# Install with:  sudo cp loadtest/scripts/limits-loadtest.conf /etc/security/limits.d/loadtest.conf
# Or run:        sudo ./loadtest/scripts/tune-client.sh
#
# These limits are read by PAM (pam_limits.so) on login. Changes take effect
# in NEW shell sessions only -- existing sessions keep their old limits.
#
# This is the CLIENT-SIDE companion to the server limits in:
#   scripts/limits-whisper.conf
#
# NOTE (Docker): Container processes inherit limits from the Docker daemon,
# not from /etc/security/limits.d/. Use --ulimit nofile=1048576:1048576 in
# docker run, or set ulimits in docker-compose.yml.
# =============================================================================

# --- File Descriptors (nofile) ---
# Each outbound WebSocket connection = 1 file descriptor.
# 1,048,576 = 1M, matching the maximum target connection count.
# Both soft and hard are set equal so the load test process gets the full
# allocation without needing to call setrlimit() at startup.
*        soft    nofile    1048576
*        hard    nofile    1048576
root     soft    nofile    1048576
root     hard    nofile    1048576

# --- Max User Processes (nproc) ---
# Load test tools may spawn helper threads or child processes. A generous
# limit avoids unexpected "fork: Resource temporarily unavailable" errors.
*        soft    nproc     65535
*        hard    nproc     65535
